


# Тестовое задание для Backend

## Описание задания

Необходимо создать Web API на Spring Boot, который будет по запросу забирать данные из публичного API национального банка и сохранять данные в локальную базу данных PostgreSQL. Для этого нужно выполнить следующие действия:

1.  Развернуть локально PostgreSQL и создать базу данных `TEST`.
2.  Создать таблицу `R_CURRENCY` с применением EF CodeFirst.
3.  Создать два метода API:
    -   Метод `.../currency/save/{date}`, который принимает параметр `date`, передает его в API нац. банка, получает данные и сохраняет их в таблицу `R_CURRENCY`.
    -   Метод `.../currency/{date}/{*code}`, который принимает параметры `date` и `code`, получает данные из таблицы `R_CURRENCY` и возвращает их в формате JSON.

## Описание таблицы `R_CURRENCY`

Таблица `R_CURRENCY` содержит следующие поля:

-   `ID` - int [PK, автоинкремент]
-   `TITLE` - varchar(60) [описание – наименование валюты]
-   `CODE` - varchar(3) [описание – код валюты]
-   `VALUE` - numeric(18,2) [описание – значение]
-   `A_DATE` - date [описание – на дату выгрузки]

Все поля таблицы запрещают вставку NULL-значений.


## Как запустить проект

1.  Склонируйте репозиторий.
2.  Создайте локальную базу данных PostgreSQL и настройте строку подключения в файле `application.properties`.
3.  Запустите проект в Visual Studio или с помощью команды `mvn spring-boot:run` в командной строке.
4.  Вызовите методы API через утилиту для тестирования API, например, Postman.

## Методы API

### `.../currency/save/{date}`

Метод `.../currency/save/{date}` сохраняет данные из API нац. банка в таблицу `R_CURRENCY`.

#### Параметры запроса:

-   `date` - дата в формате `dd.MM.yyyy`.

#### Пример запроса:

```
GET /currency/save/30.03.2023 HTTP/1.1
Host: localhost:4950
```

#### Ответ:

-   `count` - количество внесенных в таблицу записей.

```
HTTP/1.1 200 OK
Content-Type: application/json

{
    "count": 39
}


```
#### Пример неуспешного ответа:

```
{
  "code": 500,
  "message": "Content is not allowed in prolog."
}
```

### `.../currency/{date}/{code}`

Метод `.../currency/{date}/{*code}` возвращает данные из таблицы `R_CURRENCY`.

#### Параметры запроса:

-   `date` - дата в формате `dd.MM.yyyy`.
-   `code` - код валюты.

#### Пример запроса:

```
GET /currency/30.03.2023/USD`
```

#### Ответ:
```
[
    {
        "id": 3,
        "title": "ДОЛЛАР США",
        "code": "USD",
        "value": 441.47,
        "aDate": "2023-03-30"
    }
]
```
```
 HTTP/1.1 200 OK Content-Type: application/json
```

#### Пример неуспешного ответа:
```
[
    {
      
    }
]
```

------------------
## Описание сервиса

Сервис `CurrencyService` позволяет получить курсы валют за определенную дату от Национального Банка РК и сохранить их в базу данных. Сервис использует REST API Национального Банка Республики Казахстан для получения данных о курсах валют и XML-парсер для их обработки.

## Возможности сервиса

-   Получение курсов валют за определенную дату от Национального Банка РК.
-   Сохранение курсов валют в базу данных.
-   Обработка полученных данных с помощью XML-парсера.
-   Возврат количества сохраненных курсов валют в базу данных.

## Использование сервиса

Для использования сервиса необходимо выполнить GET запрос по URL-адресу `/save/{date}`, где `{date}` - дата в формате `dd.MM.yyyy`. В ответ на запрос сервис вернет JSON объект, содержащий количество сохраненных курсов валют в базу данных. Если формат даты не соответствует заданному формату, сервис вернет JSON объект с ошибкой.

Пример запроса:

```
GET /save/01.04.2022 HTTP/1.1
Host: localhost:8080
```

Пример ответа:

```
HTTP/1.1 200 OK
Content-Type: application/json

{
    "count": 39
}

```